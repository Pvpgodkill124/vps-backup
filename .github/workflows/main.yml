name: Minecraft Server Runner

on:
  # Triggers the workflow on a manual dispatch (button click in the GitHub Actions tab)
  workflow_dispatch:
    inputs:
      version:
        description: 'Minecraft Version'
        required: true
        default: '1.21.8'
  
  # Optional: Triggers a restart every 6 hours (e.g., at 00:00, 06:00, 12:00, 18:00 UTC)
  # You must still manually handle the world data persistence!
  # schedule:
  #   - cron: '0 */6 * * *' 

jobs:
  run-server:
    # Use a high-spec runner if available for better performance
    runs-on: ubuntu-latest
    
    # Optional: Configure a higher RAM/CPU runner if you have access to larger runners
    # runs-on: ubuntu-latest-8-cores
    
    steps:
    - name: â¬‡ï¸ Checkout Repository
      uses: actions/checkout@v4

    - name: â˜• Setup Java
      # Minecraft servers require Java. This action sets it up.
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21' # Adjust based on Minecraft version

    - name: âš™ï¸ Setup Minecraft Server Files
      # Download server files, eula.txt, and server.properties
      run: |
        # Download your preferred server jar (e.g., PaperMC)
        # Replace the URL with the correct one for your chosen server type/version
        wget -O server.jar "https://fill-data.papermc.io/v1/objects/8de7c52c3b02403503d16fac58003f1efef7dd7a0256786843927fa92ee57f1e/paper-1.21.8-60.jar" 
        
        # Accept the EULA (Crucial step!)
        echo "eula=true" > eula.txt
        
        # (Optional) Download and set up your world and config from Artifacts/other storage
        # ...

    - name: ğŸŒ Install and Start Tunneling Service (e.g., playit.gg or ngrok)
      # A tunneling service is required to make the server publicly accessible.
      # This step would install and run the tunnel in the background.
      run: |
        # Example for a tunneling tool (Actual commands will vary)
        echo "Starting tunneling service..."
        # Example: ./playit_cli start --secret ${{ secrets.PLAYIT_SECRET }} &

    - name: ğŸš€ Start Minecraft Server (Runs for up to 6 hours)
      # The server runs in the foreground. The job will block here until timeout.
      run: |
        echo "Starting Minecraft Server. Job will terminate in ~6 hours."
        java -Xms4G -Xmx8G -jar server.jar nogui
        
    - name: ğŸ’¾ Save World Data (If server shut down cleanly)
      # Upload the world data as an Artifact so it can be restored on the next run
      uses: actions/upload-artifact@v4
      with:
        name: minecraft-world-data
        path: world_folder_name/ # Replace with the actual world folder name
